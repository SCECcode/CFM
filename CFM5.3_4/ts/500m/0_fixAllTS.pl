#!/usr/bin/perl
# fixAllTS.pl
# Written by Scott T. Marshall
# 2020-07-09
#-----------------------------------------------------------------------------------------------------------------------------#
# 
# This script reads all gocad .ts files in the current directory and runs fixTS.pl on each file.
# This ensures that all faults are a single patch and have vertices in order. 
#
# WARNING: Make sure 0_fixTS.pl is in your pwd and is set to dump the fixed files to ../
# 
#   Usage: ./0_fixAllTS.pl
# 
#-----------------------------------------------------------------------------------------------------------------------------#
#Use warnings, but skip warnings about uninitialized variables, since this happens every time you read in a blank line.
use warnings; no warnings "uninitialized";

#-----------------------------------------------------------------------------------------------------------------------------#
#------- USER-SPECIFIED PARAMETERS -------------------------------------------------------------------------------------------#
#-----------------------------------------------------------------------------------------------------------------------------#


#-----------------------------------------------------------------------------------------------------------------------------#
#------- BASIC ERROR HANDLING ------------------------------------------------------------------------------------------------#
#-----------------------------------------------------------------------------------------------------------------------------#


#-----------------------------------------------------------------------------------------------------------------------------#
#------- GET THE TS FILE LIST ------------------------------------------------------------------------------------------------#
#-----------------------------------------------------------------------------------------------------------------------------#
#get the ts file list
@tsFiles=`ls *.ts`;
chomp(@tsFiles);

#grab the number of ts files from the array length
$countT=@tsFiles;

#make sure some ts files were found
if(@tsFiles==0){print "\n  Error! No .ts files found here\n\n"; exit}



#-----------------------------------------------------------------------------------------------------------------------------#
#------- READ AND FIX EACH GOCAD FILE ----------------------------------------------------------------------------------------#
#-----------------------------------------------------------------------------------------------------------------------------#
print "\nReading all .ts files...\n";
print "------------------------------------------------------------------------------------------------\n";

#loop through the ts files
#for($i=0; $i<1; $i++){
for($i=0; $i<@tsFiles; $i++){
	#run fixTS.pl on each file
	system "./0_fixTS.pl $tsFiles[$i]";
}#end for $i (reading the ts files loop)

#print the number of ts files found
print "------------------------------------------------------------------------------------------------\n";
print "$countT Total files processed\n\n";

